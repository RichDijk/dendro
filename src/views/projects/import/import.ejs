<%- include ../../layout/header.ejs %>

<h1 class="page-header">
    <%=locals.title %>
</h1>

<link rel="stylesheet" type="text/css" href="/bower_components/angular-tree-widget/dist/angular-tree-widget.min.css">


<script type="text/javascript" src="/app/js/controllers/project/import/import_project_controller.js"></script>
<script type="text/javascript" src="/app/js/controllers/uploads/uploads_controller.js"></script>

<div ng-controller="importProjectCtrl as importProjectCtrl" ng-init="init()">
    <div ng-controller="uploadsCtrl as uploadsCtrl"
         ng-init="init(
            get_upload_url,
            null,
            null,
            null,
            upload_completed,
            0
        )">
    <div class="alert alert-info">
        This page allows you to import a project produced by Dendro. We will guide you through the process.
        <br>
        Start by uploading a <strong>ZIP file</strong> produced by the "Backup" operation in the projects list of your original Dendro installation.
    </div>

    <form name="myForm">
        <div class="form-group">
            <label for="handle" class="col-sm-2 control-label">Enter the imported project handle</label>

            <div class="col-sm-10">
                <input type="text"
                       class="form-control"
                       id="handle"
                       placeholder="The handle of the imported project"
                       ng-model="handle">
                <p class="help-block">This will be a unique identifier for the project that will be created after importing this backup. <u>Only lower case and numbers.</u> Example: "gravimetry01" </p>
                <span ng-show="!handle" class="glyphicon glyphicon-remove form-control-feedback"></span>
                <span ng-show="valid_word(handle) && handle" class="glyphicon glyphicon-ok form-control-feedback"></span>
                <span ng-show="!valid_word(handle) && handle" class="glyphicon glyphicon-warning-sign form-control-feedback"></span>
            </div>
        </div>

        <div class="form-group">
            <label for="upload" class="col-sm-2 control-label">Select your backup file</label>
            <div class="col-sm-10">
                <input type="file" ngf-select ng-model="file" name="new_project_file" ngf-accept="'application/zip'" required="" ng-show="!uploading">

                {{file.name}}

                <div class="progress" ng-show="uploading">
                    <div class="progress-bar progress-bar-striped"
                         role="progressbar"
                         id="upload"
                         aria-valuenow="{{file.progress}}"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         ng-class="{animated: uploading}"
                         style="width: {{file.progress}}%">
                        <span class="sr-only">{{file.upload_progress}}% Complete</span>
                    </div>
                </div>
                <p class="help-block">
                    A <u>ZIP file</u> containing a project backup.
                    Maximum zip file size : <%= locals.maxUploadSize %>. Maximum project size after unzipping : <%= locals.maxProjectSize %>
                </p>
            </div>
        </div>

        <div class="col-sm-10">
            <button class="btn btn-primary" id="import_button" ng-click="import_project(file)">
                Import project
            </button>
        </div>
    </form>
</div>
</div>

<%- include ../../layout/footer.ejs %>
