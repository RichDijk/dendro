<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>src/export_libs/zenodo/zenodo.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#arrayContainsArray">arrayContainsArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#buildCkanFileIDsFromDendroFileNames">buildCkanFileIDsFromDendroFileNames</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#buildExtrasJSONArray">buildExtrasJSONArray</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#buildPackageForCkanExport">buildPackageForCkanExport</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#buildPermissionsToBeCheck">buildPermissionsToBeCheck</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calculateCkanRepositoryDiffs">calculateCkanRepositoryDiffs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#calculateDendroDiffs">calculateDendroDiffs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkIfFolderAndTargetRepositoryHaveRequiredMetadata">checkIfFolderAndTargetRepositoryHaveRequiredMetadata</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkIfResourceHasTheRequiredMetadataForExport">checkIfResourceHasTheRequiredMetadataForExport</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkPrivacyOfProject">checkPrivacyOfProject</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#checkResourceTypeAndChildren">checkResourceTypeAndChildren</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#checkRoleInSystem">checkRoleInSystem</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#Config">Config</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createCkanFileIdBasedOnDendroFileName">createCkanFileIdBasedOnDendroFileName</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createOrUpdateFilesInPackage">createOrUpdateFilesInPackage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createPackageID">createPackageID</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#createPackageInCkan">createPackageInCkan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#deleteResourceInCkan">deleteResourceInCkan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#exportPackageToCkan">exportPackageToCkan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#get_recommendations">get_recommendations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getAllPosts">getAllPosts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getBothDendroDiffsAndCkanDiffs">getBothDendroDiffsAndCkanDiffs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getExportedAtByDendroForCkanDataset">getExportedAtByDendroForCkanDataset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#isObject">isObject</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#jarPath">jarPath</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#mergeDeep">mergeDeep</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#purgeCkanDataset">purgeCkanDataset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#register_interaction">register_interaction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#repository_types">repository_types</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#request">request</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updateOrInsertExportedAtByDendroForCkanDataset">updateOrInsertExportedAtByDendroForCkanDataset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#updatePackageInCkan">updatePackageInCkan</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#validateChangesPermissions">validateChangesPermissions</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#verifyIfCkanFileWasCreatedInDendro">verifyIfCkanFileWasCreatedInDendro</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">src/export_libs/zenodo/zenodo.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by Filipe on 01/10/2014.
 */
const request = require("request");

const rlequire = require("rlequire");
const Logger = rlequire("dendro", "src/utils/logger.js").Logger;

const isNull = rlequire("dendro", "src/utils/null.js").isNull;

function Zenodo (accessToken, intanceBaseUrl)
{
    this.oauth = {};
    if (isNull(accessToken))
    {
        throw new Error("Undefined access token");
    }
    else
    {
        this.accessToken = accessToken;
        this.accessTokenURL = "?access_token=" + accessToken;
    }

    if (isNull(intanceBaseUrl))
    {
        throw new Error("Undefined instance base url");
    }
    else
    {
        this.apiURL = "https://" + intanceBaseUrl + "/api";
        this.depositionsURL = this.apiURL + "/deposit/depositions";
    }
}

Zenodo.depositionFilesPath = "/files";
Zenodo.actionsEditPath = "/actions/edit";
Zenodo.actionsPublishPath = "/actions/publish";

Zenodo.prototype.getDeposition = function (depositionID, callback)
{
    request.get({
        url: this.depositionsURL + "/" + depositionID + this.accessTokenURL,
        json: true
    },
    function (e, r, data)
    {
        if (e)
        {
            Logger.log("error", e);
            return callback(true);
        }
        return callback(null, data);
    });
};
Zenodo.prototype.getDepositionsList = function (callback)
{
    request.get({
        url: this.depositionsURL + this.accessTokenURL,
        json: true
    },
    function (e, r, depositions)
    {
        if (e)
        {
            Logger.log("error", e);
            return callback(true);
        }
        return callback(null, depositions);
    });
};

Zenodo.prototype.createDeposition = function (data, callback)
{
    request.post({
        url: this.depositionsURL + this.accessTokenURL,
        body: {
            metadata: {
                title: data.title || "no_title_available",
                description: data.description || "no_description_available",
                upload_type: "dataset",
                creators: [{name: data.creator || "no_creator_available"}],
                access_right: "closed",
                license: "cc-zero"
            }

        },
        json: true
    },
    function (e, r, depositition)
    {
        if (r.statusCode !== 201)
        {
            Logger.log("error", depositition.message);
            return callback(true, depositition);
        }
        return callback(false, depositition);
    });
};

Zenodo.prototype.uploadFileToDeposition = function (depositionID, file, callback)
{
    const fs = require("fs");
    const r = request.post({
        url: this.depositionsURL + "/" + depositionID + Zenodo.depositionFilesPath + this.accessTokenURL,
        json: true
    },
    function (e, r, data)
    {
        if (r.statusCode !== 201)
        {
            Logger.log("error", r.body.message);
            return callback(r.body.message);
        }
        return callback(false);
    });

    const form = r.form();
    form.append("file", fs.createReadStream(file));
};
Zenodo.prototype.uploadMultipleFilesToDeposition = function (depositionID, files, callback)
{
    const async = require("async");
    const self = this;
    async.each(files, function (file, callback)
    {
        self.uploadFileToDeposition(depositionID, file, function (err)
        {
            if (err)
            {
                return callback(err);
            } return callback(false);
        });
    },
    function (err)
    {
        if (err)
        {
            return callback(err);
        }
        return callback(false);
    });
};
Zenodo.prototype.depositionEdit = function (depositionID, callback)
{
    request.post({
        url: this.depositionsURL + "/" + depositionID + Zenodo.actionsEditPath + this.accessTokenURL,
        json: true
    },
    function (e, r, data)
    {
        if (e)
        {
            Logger.log("error", e);
            return callback(true);
        }
        return callback(false, data);
    });
};
Zenodo.prototype.depositionPublish = function (depositionID, callback)
{
    request.post({
        url: this.depositionsURL + "/" + depositionID + Zenodo.actionsPublishPath + this.accessTokenURL,
        json: true
    },
    function (e, r, data)
    {
        if (r.statusCode !== 202)
        {
            Logger.log("error", e);
            return callback(true);
        }
        return callback(false, data);
    });
};

module.exports = Zenodo;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Apr 23 2019 22:03:50 GMT+0100 (WEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
