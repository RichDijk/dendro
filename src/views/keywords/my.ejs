<%- include ../layout/header.ejs %>

<div ng-controller="projectsCtrl" xmlns="http://www.w3.org/1999/html">
    <h1 class="page-header">
        Your projects
    </h1>


    <% if(!(typeof locals.projects === 'undefined') && locals.projects instanceof Array)
    {
    %>
    <% if(locals.projects.length > 0)
    {
    %>

    <table class="table table-striped table-hover">

        <thead>
        <tr>
            <th width="20%">Title</th>
            <th width="40%">Description</th>
            <th width="40%"></th>
        </tr>
        </thead>
        <tbody>
        <% for(var i = 0; i < locals.projects.length; i++)
        {
            var project = locals.projects[i];
        %>
        <%if(project && (!project.ddr.deleted == 1 || (locals.user != null))) { %>
        <tr
                <%if(project.ddr.deleted == 1) {%>
                class="warning"
                <%}%>
        >

            <td>
                <% if(project.ddr.deleted)
                {
                %>
                <s>
                    <%
                    }
                    %>
                    <form>
                        <div class="btn-group">
                            <%if(!project.ddr.hasErrors && !project.ddr.is_being_imported)
                            {
                            %>
                            <button type="submit" class="btn btn-default" onclick="location.href='<%=project.uri%>'">
                                <img class="icon16" id="upload_button" src="/images/icons/box_closed.png"> <%= (project.dcterms.title)? project.dcterms.title : project.ddr.handle %>
                            </button>
                            <%} else {%>
                            <button style='color:red;text-decoration:line-through' type="submit" class="btn btn-default">
                                <img class="icon16" id="upload_button" src="/images/icons/box_closed.png"> <%= (project.dcterms.title)? project.dcterms.title : project.ddr.handle %>
                            </button>
                            <%}%>
                            <%
                            if(locals.user != null && locals.user.uri == project.dcterms.creator)
                            {
                            %>

                            <%
                            }
                            %>
                        </div>
                    </form>
                    <% if(!project.ddr.deleted)
                    {
                    %>
                </s>
                <%
                }
                %>
            </td>
            <td>

                <% if(project.ddr.deleted)
                {
                %>
                <s>
                    <%
                    }
                    %>
                    <b><%= project.dcterms.description %></b>
                    <% if(!project.ddr.deleted)
                    {
                    %>
                </s>
                <%
                }
                %>
            </td>
        </tr>
        <% }  %>
        <% } %>
        </tbody>
    </table>
    <div abso class="panel-body" style="background-color: white;">
        <div class="row">
            <div class="col-md-3 col-xs-12 col-sm-3" ng-controller="fileExplorerCtrl" ng-init="init()">
                <div class="row">
                    <div class="col-xs-12">
                        <br/>
                        <!-- Split button -->
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" ng-hide="files_exist_in_clipboard()" ng-click="toggle_upload_area()" ng-if="!showing_a_file()">
                                <img class="icon16" id="upload_button" data-loading-text="Uploading..." src="/images/icons/page_white_get.png"> Upload
                            </button>
                            <button class="btn btn-default" ng-click="download_folder()" ng-if="showing_a_file()">
                                <img class="icon16" id="download_folder_button" data-loading-text="Preparing Package..." src="/images/icons/arrow_down.png"> Download
                            </button>
                            <button type="button" class="btn btn-success" ng-show="files_exist_in_clipboard()" ng-click="paste()">
                                <img class="icon16" id="paste_button" src="/images/icons/page_paste.png">&nbsp; Paste &nbsp; <span ng-show="files_exist_in_clipboard()" class="badge badge-info">{{get_clipboard_file_count()}}</span>
                            </button>
                            <button type="button" class="btn btn-default" ng-show="files_exist_in_clipboard()" ng-click="clear_clipboard()">
                                <img class="icon16" id="paste_button" src="/images/icons/cancel.png">&nbsp; Abort</span>
                            </button>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>

                            <ul class="dropdown-menu">
                                <li ng-click="mkdir()" ng-if="!showing_a_file()"><a href="#"><img class="icon16" id="new_folder_button" data-loading-text="Creating folder..." src="/images/icons/folder_add.png">Add folder</a></li>
                                <li role="separator" class="divider" ng-if="!showing_a_file()"></li>
                                <!--<li ng-click="copy()" ng-hide="showing_project_root()"><a href="#"><img class="icon16" id="copy_button" src="/images/icons/page_copy.png">Copy</a></li> -->
                                <li ng-click="cut()" ng-hide="showing_project_root()"><a href="#"><img class="icon16" id="cut_button"  src="/images/icons/cut.png">Cut</a></li>
                                <li ng-click="rename()" ng-hide="showing_project_root()"><a href="#"><img class="icon16" id="rename_button" src="/images/icons/textfield_rename.png">Rename</a></li>
                                <li ng-click="delete_file_or_folder()" ><a href="#" ng-show="(get_selected_files() && get_selected_files().length > 0)"><img class="icon16" id="delete_button" data-loading-text="Preparing Package..." src="/images/icons/cross.png">Delete</a></li>
                                <li role="separator" class="divider" ng-hide="showing_project_root() || showing_a_file()"></li>
                                <li ng-click="download_folder()" ng-if="!showing_a_file()"><a href="#"><img class="icon16" id="download_folder_button" data-loading-text="Preparing Package..." src="/images/icons/arrow_down.png">Download</a></li>
                                <li ng-click="backup_folder()" ><a href="#" ng-hide="showing_project_root() || showing_a_file()"><img class="icon16" id="backup_button" data-loading-text="Preparing Package..." src="/images/icons/folder_vertical_zipper.png">Backup</a></li>
                                <li role="separator" class="divider" ng-hide="showing_project_root() || showing_a_file()"></li>
                                <li ng-click="toggle_restore_area()" ><a href="#" ng-hide="showing_project_root() || showing_a_file()"><img class="icon16" id="restore_button" data-loading-text="Restoring..." src="/images/icons/site_backup_and_restore.png">Restore from backup</a></li>
                            </ul>
                        </div>

                        <a href="#"><img id="show_deleted_files_button" ng-class="{active: shared.showing_deleted_files, 'btn-info': shared.showing_deleted_files}" data-loading-text="Restoring..." ng-click="toggle_show_deleted_files()" src="/images/icons/bin_recycle.png"></a>
                        <a href="#"><img id="toggle_multiple_selection" ng-class="{active: shared.multiple_selection_active, 'btn-info': shared.multiple_selection_active}" ng-click="toggle_multiple_selection()"  src="/images/icons/check_box_list.png"></a>
                        <a href="#"><img id="toggle_select_all" ng-click="toggle_select_all_files()"  src="/images/icons/check_boxes_series.png"></a>

                        <div class="ng-hide"
                             id="file_upload_area">
                        </div>
                    </div>

                    <div ng-controller="uploadsCtrl" ng-init="init(get_upload_url, 'upload_files', 'upload_files_invalid', 'upload_files_successful', upload_callback, 5000)">
                        <div class="col-xs-12 ng-hide">
                            <%- include ../uploads/upload_box.ejs %>
                        </div>
                        <div class="col-xs-12">
                            <br/>
                            <div class="row" ng-repeat="file in upload_files">
                                <%- include ../uploads/file_upload_progress_bar.ejs %>
                            </div>
                        </div>
                    </div>

                    <div ng-controller="uploadsCtrl" ng-init="init(get_restore_url, 'restore_files', 'restore_files_invalid', 'restore_files_successful', restore_callback, 5000)">
                        <div class="col-xs-12 ng-hide">
                            <%- include ../uploads/restore_upload_box.ejs %>
                        </div>
                        <div class="col-xs-12">
                            <br/>
                            <div class="row" ng-repeat="file in restore_files">
                                <%- include ../uploads/restore_resource_upload_progress_bar.ejs %>
                            </div>
                        </div>
                    </div>

                    <br/>
                    <br/>
                </div>

                <script type="text/javascript">
                  $('#new_folder_button').tooltip({title : "<h4>Add folder</h4>Create a new folder here", html: true});
                  $('#upload_button').tooltip({title : "<h4>Upload</h4>Upload files to the current folder", html: true});
                  $('#download_folder_button').tooltip({title : "<h4>Download</h4>Download the current folder or file" , html: true});
                  $('#backup_button').tooltip({title : "<h4>Backup</h4>Download the current folder, including information", html:true});
                  $('#restore_button').tooltip({title : "<h4>Restore</h4>Replace the contents of the current folder with the contents of a backup package", html:true});
                  $('#show_deleted_files_button').tooltip({title : "<h4>Show Deleted</h4>Show Deleted Files", html:true});
                  $('#toggle_multiple_selection').tooltip({title : "<h4>Select several</h4>Select several files", html:true});
                  $('#toggle_select_all').tooltip({title : "<h4>Select all</h4>Select all files", html:true});
                </script>


                <div class="row ng-hide" id="restore_upload_area" ng-show="restore_area_visible && still_uploading_files()" ng-controller="uploadsCtrl" ng-init="init(get_calling_uri)">
                    <div class="col-xs-12 ng-hide">
                        <%- include ../uploads/upload_box.ejs %>
                    </div>
                    <div class="col-xs-12">
                        <br/>
                        <div class="row" ng-repeat="file in upload_files">
                            <%- include ../uploads/file_upload_progress_bar.ejs %>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xs-12">
                        <%- include ../projects/show/file_explorer.ejs %>
                    </div>
                </div>
            </div>

        </div>
        <div class="btn-group pull-right">
            <div class="pull-right">
                <button class="btn btn-default btn-sm">Continue</button>
            </div>
        </div>
    </div>
    <% } else { %>
    <div class="row">
        <br/>
        <div class="col-xs-12">
            <div class="alert alert-info">
                You have not created any projects nor are registered as a contributor of any project.
                <br/>
                <br/>
                Please create a project using the button you can see above this message or ask the creator of a project to add you as a contributor.
            </div>
        </div>
    </div>

    <% }  %>
    <% } %>
    <%- include ../layout/footer.ejs %>

</div>
